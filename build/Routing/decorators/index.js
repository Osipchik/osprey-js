"use strict";var He=Object.create;var v=Object.defineProperty;var Se=Object.getOwnPropertyDescriptor;var De=Object.getOwnPropertyNames;var Oe=Object.getPrototypeOf,Le=Object.prototype.hasOwnProperty;var ke=(r,e,t)=>e in r?v(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var a=(r,e)=>v(r,"name",{value:e,configurable:!0});var $e=(r,e)=>()=>(r&&(e=r(r=0)),e);var W=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),z=(r,e)=>{for(var t in e)v(r,t,{get:e[t],enumerable:!0})},G=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of De(e))!Le.call(r,i)&&i!==t&&v(r,i,{get:()=>e[i],enumerable:!(n=Se(e,i))||n.enumerable});return r};var Pe=(r,e,t)=>(t=r!=null?He(Oe(r)):{},G(e||!r||!r.__esModule?v(t,"default",{value:r,enumerable:!0}):t,r)),U=r=>G(v({},"__esModule",{value:!0}),r);var d=(r,e,t)=>(ke(r,typeof e!="symbol"?e+"":e,t),t);var V=W(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});var w;(function(r){r[r.STATIC=0]="STATIC",r[r.PARAM=1]="PARAM"})(w||(w={}));var M=":",Fe="/",je=Fe.charCodeAt(0),y=class{constructor(e={}){this.indices=e.indices||"",this.children=e.children||[],this.childrenI=e.childrenI||{},this.path=e.path||"",this.handle=e.handle||null,this.wildChild=e.wildChild||!1,this.type=e.type||w.STATIC,this.param=e.param||"",this.pathLength=this.path.length,this.childrenLength=this.children.length}addRoute(e,t){let n=this.countParams(e);this.isEmpty()?this.insertChild(e,e,t,n):this.onChunk(this,e,e,t,n)}search(e){let t=this,n={};e:for(;;){let i=e.length;if(i>t.pathLength&&e.slice(0,t.pathLength)===t.path){if(e=e.slice(t.pathLength),t.wildChild){t=t.children[0];let o=0;for(;o<i&&e.charCodeAt(o)!==je;)o++;let l=e.slice(0,o);if(!l||!t.param)return{value:null,params:n};if(t.param!=="!"&&(n[t.param]=l),o<i){if(t.childrenLength===0)return{value:null,params:n};e=e.slice(o),t=t.children[0];continue e}return{value:t.handle,params:n}}let s=e.charCodeAt(0);for(let o=0;o<t.indices.length;o++)if(s===t.indices.charCodeAt(o)){t=t.children[o];continue e}}else if(e===t.path)return{value:t.handle,params:n};return{value:null,params:n}}}hasChildren(){return this.children.length>0}insertChild(e,t,n,i){let s=0,o=this;for(let l=0,u=t.length;i>0;l++){if(t[l]!==M)continue;let m=l+1;for(;m<u&&t[m]!=="/";){if(t[m]===M)throw new Error("only one wildcard per path segment is allowed, has: '"+t.slice(l)+"' in path '"+e+"'");m++}if(o.hasChildren())throw new Error("wildcard route '"+t.slice(l,m)+"' conflicts with existing children in path '"+e+"'");if(m-l<2)throw new Error("wildcards must be named with a non-empty name in path '"+e+"'");l>0&&(o.replacePath(t.slice(s,l)),s=l),o=o.replaceChildren({type:w.PARAM}),i--,m<u&&(o.replacePath(t.slice(s,m)),s=m,o=o.replaceChildren())}o.replacePath(t.slice(s)),o.setHandle(n)}setHandle(e){this.handle=e}replaceChildren(e={}){let t=new y(e);return e.type===w.PARAM&&(this.wildChild=!0),this.children=[t],this.childrenLength=1,t}replacePath(e){e[0]===M&&(this.param=e.slice(1)),this.path=e,this.pathLength=e.length}isEmpty(){return!(this.path.length>0||this.children.length>0)}processCharacter(e,t,n,i){let s=t[0];if(this.type===w.PARAM&&s==="/"&&this.children.length===1){this.onChunk(this.children[0],e,t,n,i);return}let o=this.childrenI[s.charCodeAt(0)];if(o){o.onChunk(o,e,t,n,i);return}if(s!==M){let l=new y({type:w.STATIC});this.children.push(l),this.indices+=s,this.childrenI[s.charCodeAt(0)]=l,this.childrenLength=this.children.length,l.insertChild(e,t,n,i);return}this.insertChild(e,t,n,i)}processWildcard(e,t,n,i){if(t.length>=this.path.length&&this.path===t.slice(0,this.path.length)&&(this.path.length>=t.length||t[this.path.length]==="/")){this.onChunk(this,e,t,n,i);return}let o=t.split("/")[0],l=e.slice(0,e.indexOf(o))+this.path;throw new Error(`'${o}' in new path '${e}' conflicts with existing wildcard '${this.path}' in existing prefix '${l}'`)}createNode(e,t,n,i,s){let o=n.slice(e);if(this.wildChild){this.children[0].processWildcard(t,o,i,s-1);return}this.processCharacter(t,o,i,s)}commonPrefixIndex(e){let t=0,n=Math.min(e.length,this.path.length);for(;t<n&&this.path[t]===e[t];)t++;return t}split(e,t){if(e<this.path.length){let n=new y({path:this.path.slice(e),wildChild:this.wildChild,childrenI:this.childrenI,children:this.children,handle:this.handle,indices:this.indices});return this.children=[n],this.indices=this.path[e],this.childrenI={[this.indices.charCodeAt(0)]:n},this.childrenLength=1,this.wildChild=!1,this.path=t.slice(0,e),this.pathLength=this.path.length,this.handle=null,!0}return!1}onChunk(e,t,n,i,s){let o=e.commonPrefixIndex(n),l=e.split(o,n);if(o<n.length)e.createNode(o,t,n,i,s);else if(o===n.length){if(!l)throw new Error("Route already defined.");this.handle=i}}countParams(e){let t=0;for(let n=0;n<e.length;n++)e[n]===M&&t++;return t}};a(y,"Node");L.Node=y});var J=W(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});var qe=V();function B(r,e){if(!e)throw new Error("Path is required.");if(!r)throw new Error("Bucket is required.");if(typeof r!="string")throw new Error("Bucket should be a string.");if(typeof e!="string")throw new Error("Path should be a string.")}a(B,"typeCheck");var R=class{constructor(){this.buckets={}}addRoute(e,t,n){if(B(e,t),t[0]!=="/"&&t[0]!=="*")throw new Error("The first character of a path should be `/` or `*`.");t=t.replace(/\*([A-z0-9]+)?\//g,":!/").replace(/\*$/g,":!"),this.buckets[e]||(this.buckets[e]=new qe.Node),this.buckets[e].addRoute(t,n)}findRoute(e,t){if(B(e,t),!this.buckets[e])return null;let n=this.buckets[e].search(t);return n.value===null?null:{value:n.value,params:n.params}}};a(R,"RoadRunner");k.RoadRunner=R});var X={};z(X,{default:()=>N});function $(r,e){return r?`\x1B[${r}m${e}\x1B[0m`:e}function Q(r,e){for(let t of r.split(","))if(t.length===1)e=$(We[t],e);else{let[n,i]=t.split("/"),s=K.indexOf(n),o=K.indexOf(i);s>-1&&(e=$(30+s,e)),o>-1&&(e=$(40+o,e))}return e}var We,K,N,P=$e(()=>{"use strict";We={b:1,f:2,i:3,u:4,l:5,h:6,n:7,c:8,s:9},K=["black","red","green","yellow","blue","magenta","cyan","white","crimson"];a($,"esc");a(Q,"stylize");N=Q;module.exports=Q});var Je={};z(Je,{Controller:()=>we,Delete:()=>Ce,Get:()=>Ee,Head:()=>Ne,Header:()=>be,Options:()=>Re,Patch:()=>Ae,Post:()=>ve,Put:()=>Ie,Trace:()=>Me});module.exports=U(Je);var ye=Pe(J(),1);var ze=(P(),U(X));function F(r,...e){let t=[r[0]],n=1;for(let i of e){let s=r[n++];if(s.startsWith("(")){let o=s.indexOf(")"),l=s.substring(1,o),u=ze(l,i),A=s.substring(o+1);t.push(u,A)}}return t.join("")}a(F,"Concollor");P();function Y(r){return(e,...t)=>{if(typeof e=="string")return N(r,e);let n=[e[0]],i=1;for(let s of t){let o=e[i++];n.push(String(s),o)}return N(r,n.join(""))}}a(Y,"Tag");var p=Y;module.exports=Y;var Z={titleTag:p("b,i,red/red"),messageTag:p("red/red"),defaultTitle:"Error"},_={titleTag:p("b,i,yellow/yellow"),messageTag:p("yellow/yellow"),defaultTitle:"Warn"},ee={titleTag:p("b,blue"),messageTag:p("blue"),defaultTitle:"Info"},te={titleTag:p("b,green"),messageTag:p("green"),defaultTitle:"Success"},re={titleTag:p("b,cyan"),messageTag:p("cyan"),defaultTitle:"Put"},ne={titleTag:p("b,crimson"),messageTag:p("crimson"),defaultTitle:"Patch"},oe={titleTag:p("b,magenta"),messageTag:p("magenta"),defaultTitle:"Data"},ie=/(https?:\/\/\S+)/gm;function f(r){let e=String(r);console.log(e.replace(ie,t=>F`${t}(u,blue)`))}a(f,"Log");function E({titleTag:r,messageTag:e,defaultTitle:t}){return function(n,i){console.log(r(`${i??t}: `)+e(`${n}`))}}a(E,"_print");f.error=E(Z);f.warn=E(_);f.info=E(ee);f.success=E(te);f.put=E(re);f.patch=E(ne);f.data=E(oe);var c=f;module.exports=f;function se(r,e){let t=`The request method: ${r.method} is not supported by the server and cannot be handled`;c.error(t,`Error ${501}`),e.statusCode=501,e.statusMessage=t,e.end()}a(se,"NotImplementedHandler");var ae=se;module.exports=se;function le(r,e,t){c.error("Unexpected Server Error",`Error ${500}`),c.error(t.message),e.statusCode=500,e.statusMessage="Internal Server Error",e.end()}a(le,"ServerErrorHandler");var pe=le;module.exports=le;function ce(r,e){let t=`The request ${r.method} ${r.url} is not allowed`;e.statusCode=405,e.statusMessage=t,e.end()}a(ce,"MethodNotAllowedHandler");var he=ce;module.exports=ce;function ue(r,e){let t=`The request ${r.method} ${r.url} is not found`;e.statusCode=404,e.statusMessage=t,e.end()}a(ue,"NotFoundHandler");var de=ue;module.exports=ue;function q(r){let e=r;for(;e.startsWith("/");)e=e.slice(1);for(;e.endsWith("/");)e=e.slice(0,-1);return"/"+e}a(q,"normalizeSlash");function ge(r,e){let t=r??"",n=e??"";if(t.includes(":"))throw new Error("cant has semicolon");if(n.includes("*"))throw new Error("cant has semicolon");let i=[],s=n.split("/").reduce((l,u)=>{if(u.includes(":")){let A=u.slice(1);if(Ge(A))i.push(u.slice(1));else throw new Error(`invalid var name: ${A}`);return l+"/"+u}return l+"/"+u},""),o=q(t);return{pathName:q(o+q(s)),prefix:o,props:i}}a(ge,"getPath");function Ge(r){if(r.trim()!==r)return!1;try{new Function(r,"var "+r)}catch{return!1}return!0}a(Ge,"isVarName");var b="GET",me="HEAD",H="POST",S="PUT",D="DELETE";var fe="OPTIONS",Te="TRACE",O="PATCH";var g=class{static addRoute(e,{method:t,prefix:n,path:i}){let{pathName:s}=ge(n,i);switch(t){case b:c.info(s,t);break;case H:c.warn(s,t);break;case D:c.error(s,t);break;case O:c.patch(s,t);break;case S:c.put(s,t);break;default:c.data(s,t)}g.router.addRoute(t,s,e)}getRequestHandler(e){if(e.method){let t=g.router.findRoute(e.method,e.url);return t?{handler:t.value,params:t.params}:{handler:g.routeHandlers.NotFound}}return{handler:g.routeHandlers.NotImplemented}}},h=g;a(h,"Router"),d(h,"ServerError",pe),d(h,"NotFound",de),d(h,"MethodNotAllowed",he),d(h,"NotImplemented",ae),d(h,"router",new ye.RoadRunner),d(h,"routeHandlers",{GET:{},HEAD:{},POST:{},PUT:{},DELETE:{},CONNECTS:{},OPTIONS:{},TRACE:{},PATCH:{},ServerError:g.ServerError,NotFound:g.NotFound,MethodNotAllowed:g.MethodNotAllowed,NotImplemented:g.NotImplemented});var xe=h;module.exports=h;var T=class{static addMeta(e,t,n){if(T.meta.has(e)){let i=T.meta.get(e);i[t]=n}else T.meta.set(e,{[t]:n});T.values.set(e.value,T.meta.get(e))}static getMeta(e){return T.meta.get(e)||T.values.get(e)}},C=T;a(C,"MetaStore"),d(C,"meta",new WeakMap),d(C,"values",new WeakMap);var I=C;function Ue(r){return function(e){for(let t of Object.getOwnPropertyNames(e.prototype)){let n=e.prototype[t],i=I.getMeta(n);i&&(i.meta.prefix=r||"",xe.addRoute(n,i.meta),delete n.meta)}}}a(Ue,"Controller");var we=Ue;function Ve(r,e){return async(t,n,...i)=>{let s={request:t,response:n};(await r.apply({...this,...s},i))(t,n,e)}}a(Ve,"asyncHandler");function x(r,e,t){return(n,i,s)=>{let o=s.value,l=I.getMeta(s);return s.value=Ve(o,l),I.addMeta(s,"meta",{path:e||"",method:r}),s}}a(x,"decoratorFabric");function Ee(r,e){return x(b,r,e)}a(Ee,"Get");function Ie(r,e){return x(S,r,e)}a(Ie,"Put");function ve(r,e){return x(H,r,e)}a(ve,"Post");function Ce(r,e){return x(D,r,e)}a(Ce,"Delete");function Ae(r,e){return x(O,r,e)}a(Ae,"Patch");function Me(r,e){return x(Te,r,e)}a(Me,"Trace");function Re(r,e){return x(fe,r,e)}a(Re,"Options");function Ne(r,e){return x(me,r,e)}a(Ne,"Head");function Be(r,e){return(t,n,i)=>{I.addMeta(i,"header",{name:r,value:e})}}a(Be,"Header");var be=Be;0&&(module.exports={Controller,Delete,Get,Head,Header,Options,Patch,Post,Put,Trace});
//# sourceMappingURL=index.js.map
