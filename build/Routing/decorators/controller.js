"use strict";var fe=Object.create;var I=Object.defineProperty;var Te=Object.getOwnPropertyDescriptor;var ye=Object.getOwnPropertyNames;var we=Object.getPrototypeOf,xe=Object.prototype.hasOwnProperty;var Ie=(r,e,t)=>e in r?I(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var l=(r,e)=>I(r,"name",{value:e,configurable:!0});var Ee=(r,e)=>()=>(r&&(e=r(r=0)),e);var S=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),k=(r,e)=>{for(var t in e)I(r,t,{get:e[t],enumerable:!0})},$=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of ye(e))!xe.call(r,o)&&o!==t&&I(r,o,{get:()=>e[o],enumerable:!(n=Te(e,o))||n.enumerable});return r};var Ae=(r,e,t)=>(t=r!=null?fe(we(r)):{},$(e||!r||!r.__esModule?I(t,"default",{value:r,enumerable:!0}):t,r)),F=r=>$(I({},"__esModule",{value:!0}),r);var u=(r,e,t)=>(Ie(r,typeof e!="symbol"?e+"":e,t),t);var q=S(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});var w;(function(r){r[r.STATIC=0]="STATIC",r[r.PARAM=1]="PARAM"})(w||(w={}));var v=":",ve="/",Ne=ve.charCodeAt(0),y=class{constructor(e={}){this.indices=e.indices||"",this.children=e.children||[],this.childrenI=e.childrenI||{},this.path=e.path||"",this.handle=e.handle||null,this.wildChild=e.wildChild||!1,this.type=e.type||w.STATIC,this.param=e.param||"",this.pathLength=this.path.length,this.childrenLength=this.children.length}addRoute(e,t){let n=this.countParams(e);this.isEmpty()?this.insertChild(e,e,t,n):this.onChunk(this,e,e,t,n)}search(e){let t=this,n={};e:for(;;){let o=e.length;if(o>t.pathLength&&e.slice(0,t.pathLength)===t.path){if(e=e.slice(t.pathLength),t.wildChild){t=t.children[0];let i=0;for(;i<o&&e.charCodeAt(i)!==Ne;)i++;let a=e.slice(0,i);if(!a||!t.param)return{value:null,params:n};if(t.param!=="!"&&(n[t.param]=a),i<o){if(t.childrenLength===0)return{value:null,params:n};e=e.slice(i),t=t.children[0];continue e}return{value:t.handle,params:n}}let s=e.charCodeAt(0);for(let i=0;i<t.indices.length;i++)if(s===t.indices.charCodeAt(i)){t=t.children[i];continue e}}else if(e===t.path)return{value:t.handle,params:n};return{value:null,params:n}}}hasChildren(){return this.children.length>0}insertChild(e,t,n,o){let s=0,i=this;for(let a=0,d=t.length;o>0;a++){if(t[a]!==v)continue;let m=a+1;for(;m<d&&t[m]!=="/";){if(t[m]===v)throw new Error("only one wildcard per path segment is allowed, has: '"+t.slice(a)+"' in path '"+e+"'");m++}if(i.hasChildren())throw new Error("wildcard route '"+t.slice(a,m)+"' conflicts with existing children in path '"+e+"'");if(m-a<2)throw new Error("wildcards must be named with a non-empty name in path '"+e+"'");a>0&&(i.replacePath(t.slice(s,a)),s=a),i=i.replaceChildren({type:w.PARAM}),o--,m<d&&(i.replacePath(t.slice(s,m)),s=m,i=i.replaceChildren())}i.replacePath(t.slice(s)),i.setHandle(n)}setHandle(e){this.handle=e}replaceChildren(e={}){let t=new y(e);return e.type===w.PARAM&&(this.wildChild=!0),this.children=[t],this.childrenLength=1,t}replacePath(e){e[0]===v&&(this.param=e.slice(1)),this.path=e,this.pathLength=e.length}isEmpty(){return!(this.path.length>0||this.children.length>0)}processCharacter(e,t,n,o){let s=t[0];if(this.type===w.PARAM&&s==="/"&&this.children.length===1){this.onChunk(this.children[0],e,t,n,o);return}let i=this.childrenI[s.charCodeAt(0)];if(i){i.onChunk(i,e,t,n,o);return}if(s!==v){let a=new y({type:w.STATIC});this.children.push(a),this.indices+=s,this.childrenI[s.charCodeAt(0)]=a,this.childrenLength=this.children.length,a.insertChild(e,t,n,o);return}this.insertChild(e,t,n,o)}processWildcard(e,t,n,o){if(t.length>=this.path.length&&this.path===t.slice(0,this.path.length)&&(this.path.length>=t.length||t[this.path.length]==="/")){this.onChunk(this,e,t,n,o);return}let i=t.split("/")[0],a=e.slice(0,e.indexOf(i))+this.path;throw new Error(`'${i}' in new path '${e}' conflicts with existing wildcard '${this.path}' in existing prefix '${a}'`)}createNode(e,t,n,o,s){let i=n.slice(e);if(this.wildChild){this.children[0].processWildcard(t,i,o,s-1);return}this.processCharacter(t,i,o,s)}commonPrefixIndex(e){let t=0,n=Math.min(e.length,this.path.length);for(;t<n&&this.path[t]===e[t];)t++;return t}split(e,t){if(e<this.path.length){let n=new y({path:this.path.slice(e),wildChild:this.wildChild,childrenI:this.childrenI,children:this.children,handle:this.handle,indices:this.indices});return this.children=[n],this.indices=this.path[e],this.childrenI={[this.indices.charCodeAt(0)]:n},this.childrenLength=1,this.wildChild=!1,this.path=t.slice(0,e),this.pathLength=this.path.length,this.handle=null,!0}return!1}onChunk(e,t,n,o,s){let i=e.commonPrefixIndex(n),a=e.split(i,n);if(i<n.length)e.createNode(i,t,n,o,s);else if(i===n.length){if(!a)throw new Error("Route already defined.");this.handle=o}}countParams(e){let t=0;for(let n=0;n<e.length;n++)e[n]===v&&t++;return t}};l(y,"Node");C.Node=y});var j=S(R=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0});var Me=q();function W(r,e){if(!e)throw new Error("Path is required.");if(!r)throw new Error("Bucket is required.");if(typeof r!="string")throw new Error("Bucket should be a string.");if(typeof e!="string")throw new Error("Path should be a string.")}l(W,"typeCheck");var N=class{constructor(){this.buckets={}}addRoute(e,t,n){if(W(e,t),t[0]!=="/"&&t[0]!=="*")throw new Error("The first character of a path should be `/` or `*`.");t=t.replace(/\*([A-z0-9]+)?\//g,":!/").replace(/\*$/g,":!"),this.buckets[e]||(this.buckets[e]=new Me.Node),this.buckets[e].addRoute(t,n)}findRoute(e,t){if(W(e,t),!this.buckets[e])return null;let n=this.buckets[e].search(t);return n.value===null?null:{value:n.value,params:n.params}}};l(N,"RoadRunner");R.RoadRunner=N});var G={};k(G,{default:()=>M});function b(r,e){return r?`\x1B[${r}m${e}\x1B[0m`:e}function U(r,e){for(let t of r.split(","))if(t.length===1)e=b(Ce[t],e);else{let[n,o]=t.split("/"),s=z.indexOf(n),i=z.indexOf(o);s>-1&&(e=b(30+s,e)),i>-1&&(e=b(40+i,e))}return e}var Ce,z,M,H=Ee(()=>{"use strict";Ce={b:1,f:2,i:3,u:4,l:5,h:6,n:7,c:8,s:9},z=["black","red","green","yellow","blue","magenta","cyan","white","crimson"];l(b,"esc");l(U,"stylize");M=U;module.exports=U});var Oe={};k(Oe,{default:()=>Le});module.exports=F(Oe);var ue=Ae(j(),1);var Re=(H(),F(G));function L(r,...e){let t=[r[0]],n=1;for(let o of e){let s=r[n++];if(s.startsWith("(")){let i=s.indexOf(")"),a=s.substring(1,i),d=Re(a,o),A=s.substring(i+1);t.push(d,A)}}return t.join("")}l(L,"Concollor");H();function V(r){return(e,...t)=>{if(typeof e=="string")return M(r,e);let n=[e[0]],o=1;for(let s of t){let i=e[o++];n.push(String(s),i)}return M(r,n.join(""))}}l(V,"Tag");var c=V;module.exports=V;var B={titleTag:c("b,i,red/red"),messageTag:c("red/red"),defaultTitle:"Error"},P={titleTag:c("b,i,yellow/yellow"),messageTag:c("yellow/yellow"),defaultTitle:"Warn"},J={titleTag:c("b,blue"),messageTag:c("blue"),defaultTitle:"Info"},K={titleTag:c("b,green"),messageTag:c("green"),defaultTitle:"Success"},Q={titleTag:c("b,cyan"),messageTag:c("cyan"),defaultTitle:"Put"},X={titleTag:c("b,crimson"),messageTag:c("crimson"),defaultTitle:"Patch"},Y={titleTag:c("b,magenta"),messageTag:c("magenta"),defaultTitle:"Data"},Z=/(https?:\/\/\S+)/gm;function f(r){let e=String(r);console.log(e.replace(Z,t=>L`${t}(u,blue)`))}l(f,"Log");function x({titleTag:r,messageTag:e,defaultTitle:t}){return function(n,o){console.log(r(`${o??t}: `)+e(`${n}`))}}l(x,"_print");f.error=x(B);f.warn=x(P);f.info=x(J);f.success=x(K);f.put=x(Q);f.patch=x(X);f.data=x(Y);var p=f;module.exports=f;function _(r,e){let t=`The request method: ${r.method} is not supported by the server and cannot be handled`;p.error(t,`Error ${501}`),e.statusCode=501,e.statusMessage=t,e.end()}l(_,"NotImplementedHandler");var ee=_;module.exports=_;function te(r,e,t){p.error("Unexpected Server Error",`Error ${500}`),p.error(t.message),e.statusCode=500,e.statusMessage="Internal Server Error",e.end()}l(te,"ServerErrorHandler");var re=te;module.exports=te;function ne(r,e){let t=`The request ${r.method} ${r.url} is not allowed`;e.statusCode=405,e.statusMessage=t,e.end()}l(ne,"MethodNotAllowedHandler");var ie=ne;module.exports=ne;function oe(r,e){let t=`The request ${r.method} ${r.url} is not found`;e.statusCode=404,e.statusMessage=t,e.end()}l(oe,"NotFoundHandler");var se=oe;module.exports=oe;function D(r){let e=r;for(;e.startsWith("/");)e=e.slice(1);for(;e.endsWith("/");)e=e.slice(0,-1);return"/"+e}l(D,"normalizeSlash");function le(r,e){let t=r??"",n=e??"";if(t.includes(":"))throw new Error("cant has semicolon");if(n.includes("*"))throw new Error("cant has semicolon");let o=[],s=n.split("/").reduce((a,d)=>{if(d.includes(":")){let A=d.slice(1);if(be(A))o.push(d.slice(1));else throw new Error(`invalid var name: ${A}`);return a+"/"+d}return a+"/"+d},""),i=D(t);return{pathName:D(i+D(s)),prefix:i,props:o}}l(le,"getPath");function be(r){if(r.trim()!==r)return!1;try{new Function(r,"var "+r)}catch{return!1}return!0}l(be,"isVarName");var ae="GET";var ce="POST",pe="PUT",he="DELETE";var de="PATCH";var g=class{static addRoute(e,{method:t,prefix:n,path:o}){let{pathName:s}=le(n,o);switch(t){case ae:p.info(s,t);break;case ce:p.warn(s,t);break;case he:p.error(s,t);break;case de:p.patch(s,t);break;case pe:p.put(s,t);break;default:p.data(s,t)}g.router.addRoute(t,s,e)}getRequestHandler(e){if(e.method){let t=g.router.findRoute(e.method,e.url);return t?{handler:t.value,params:t.params}:{handler:g.routeHandlers.NotFound}}return{handler:g.routeHandlers.NotImplemented}}},h=g;l(h,"Router"),u(h,"ServerError",re),u(h,"NotFound",se),u(h,"MethodNotAllowed",ie),u(h,"NotImplemented",ee),u(h,"router",new ue.RoadRunner),u(h,"routeHandlers",{GET:{},HEAD:{},POST:{},PUT:{},DELETE:{},CONNECTS:{},OPTIONS:{},TRACE:{},PATCH:{},ServerError:g.ServerError,NotFound:g.NotFound,MethodNotAllowed:g.MethodNotAllowed,NotImplemented:g.NotImplemented});var ge=h;module.exports=h;var T=class{static addMeta(e,t,n){if(T.meta.has(e)){let o=T.meta.get(e);o[t]=n}else T.meta.set(e,{[t]:n});T.values.set(e.value,T.meta.get(e))}static getMeta(e){return T.meta.get(e)||T.values.get(e)}},E=T;l(E,"MetaStore"),u(E,"meta",new WeakMap),u(E,"values",new WeakMap);var me=E;function He(r){return function(e){for(let t of Object.getOwnPropertyNames(e.prototype)){let n=e.prototype[t],o=me.getMeta(n);o&&(o.meta.prefix=r||"",ge.addRoute(n,o.meta),delete n.meta)}}}l(He,"Controller");var Le=He;0&&(module.exports={});
//# sourceMappingURL=controller.js.map
