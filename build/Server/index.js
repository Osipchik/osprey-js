"use strict";var xe=Object.create;var v=Object.defineProperty;var ve=Object.getOwnPropertyDescriptor;var Ee=Object.getOwnPropertyNames;var Ie=Object.getPrototypeOf,Ae=Object.prototype.hasOwnProperty;var Me=(t,e,r)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var l=(t,e)=>v(t,"name",{value:e,configurable:!0});var Ne=(t,e)=>()=>(t&&(e=t(t=0)),e);var k=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),q=(t,e)=>{for(var r in e)v(t,r,{get:e[r],enumerable:!0})},F=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ee(e))!Ae.call(t,i)&&i!==r&&v(t,i,{get:()=>e[i],enumerable:!(n=ve(e,i))||n.enumerable});return t};var z=(t,e,r)=>(r=t!=null?xe(Ie(t)):{},F(e||!t||!t.__esModule?v(r,"default",{value:t,enumerable:!0}):r,t)),W=t=>F(v({},"__esModule",{value:!0}),t);var u=(t,e,r)=>(Me(t,typeof e!="symbol"?e+"":e,r),r);var j=k(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});var y;(function(t){t[t.STATIC=0]="STATIC",t[t.PARAM=1]="PARAM"})(y||(y={}));var I=":",Re="/",Ce=Re.charCodeAt(0),T=class{constructor(e={}){this.indices=e.indices||"",this.children=e.children||[],this.childrenI=e.childrenI||{},this.path=e.path||"",this.handle=e.handle||null,this.wildChild=e.wildChild||!1,this.type=e.type||y.STATIC,this.param=e.param||"",this.pathLength=this.path.length,this.childrenLength=this.children.length}addRoute(e,r){let n=this.countParams(e);this.isEmpty()?this.insertChild(e,e,r,n):this.onChunk(this,e,e,r,n)}search(e){let r=this,n={};e:for(;;){let i=e.length;if(i>r.pathLength&&e.slice(0,r.pathLength)===r.path){if(e=e.slice(r.pathLength),r.wildChild){r=r.children[0];let o=0;for(;o<i&&e.charCodeAt(o)!==Ce;)o++;let a=e.slice(0,o);if(!a||!r.param)return{value:null,params:n};if(r.param!=="!"&&(n[r.param]=a),o<i){if(r.childrenLength===0)return{value:null,params:n};e=e.slice(o),r=r.children[0];continue e}return{value:r.handle,params:n}}let s=e.charCodeAt(0);for(let o=0;o<r.indices.length;o++)if(s===r.indices.charCodeAt(o)){r=r.children[o];continue e}}else if(e===r.path)return{value:r.handle,params:n};return{value:null,params:n}}}hasChildren(){return this.children.length>0}insertChild(e,r,n,i){let s=0,o=this;for(let a=0,d=r.length;i>0;a++){if(r[a]!==I)continue;let m=a+1;for(;m<d&&r[m]!=="/";){if(r[m]===I)throw new Error("only one wildcard per path segment is allowed, has: '"+r.slice(a)+"' in path '"+e+"'");m++}if(o.hasChildren())throw new Error("wildcard route '"+r.slice(a,m)+"' conflicts with existing children in path '"+e+"'");if(m-a<2)throw new Error("wildcards must be named with a non-empty name in path '"+e+"'");a>0&&(o.replacePath(r.slice(s,a)),s=a),o=o.replaceChildren({type:y.PARAM}),i--,m<d&&(o.replacePath(r.slice(s,m)),s=m,o=o.replaceChildren())}o.replacePath(r.slice(s)),o.setHandle(n)}setHandle(e){this.handle=e}replaceChildren(e={}){let r=new T(e);return e.type===y.PARAM&&(this.wildChild=!0),this.children=[r],this.childrenLength=1,r}replacePath(e){e[0]===I&&(this.param=e.slice(1)),this.path=e,this.pathLength=e.length}isEmpty(){return!(this.path.length>0||this.children.length>0)}processCharacter(e,r,n,i){let s=r[0];if(this.type===y.PARAM&&s==="/"&&this.children.length===1){this.onChunk(this.children[0],e,r,n,i);return}let o=this.childrenI[s.charCodeAt(0)];if(o){o.onChunk(o,e,r,n,i);return}if(s!==I){let a=new T({type:y.STATIC});this.children.push(a),this.indices+=s,this.childrenI[s.charCodeAt(0)]=a,this.childrenLength=this.children.length,a.insertChild(e,r,n,i);return}this.insertChild(e,r,n,i)}processWildcard(e,r,n,i){if(r.length>=this.path.length&&this.path===r.slice(0,this.path.length)&&(this.path.length>=r.length||r[this.path.length]==="/")){this.onChunk(this,e,r,n,i);return}let o=r.split("/")[0],a=e.slice(0,e.indexOf(o))+this.path;throw new Error(`'${o}' in new path '${e}' conflicts with existing wildcard '${this.path}' in existing prefix '${a}'`)}createNode(e,r,n,i,s){let o=n.slice(e);if(this.wildChild){this.children[0].processWildcard(r,o,i,s-1);return}this.processCharacter(r,o,i,s)}commonPrefixIndex(e){let r=0,n=Math.min(e.length,this.path.length);for(;r<n&&this.path[r]===e[r];)r++;return r}split(e,r){if(e<this.path.length){let n=new T({path:this.path.slice(e),wildChild:this.wildChild,childrenI:this.childrenI,children:this.children,handle:this.handle,indices:this.indices});return this.children=[n],this.indices=this.path[e],this.childrenI={[this.indices.charCodeAt(0)]:n},this.childrenLength=1,this.wildChild=!1,this.path=r.slice(0,e),this.pathLength=this.path.length,this.handle=null,!0}return!1}onChunk(e,r,n,i,s){let o=e.commonPrefixIndex(n),a=e.split(o,n);if(o<n.length)e.createNode(o,r,n,i,s);else if(o===n.length){if(!a)throw new Error("Route already defined.");this.handle=i}}countParams(e){let r=0;for(let n=0;n<e.length;n++)e[n]===I&&r++;return r}};l(T,"Node");C.Node=T});var U=k(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});var be=j();function P(t,e){if(!e)throw new Error("Path is required.");if(!t)throw new Error("Bucket is required.");if(typeof t!="string")throw new Error("Bucket should be a string.");if(typeof e!="string")throw new Error("Path should be a string.")}l(P,"typeCheck");var M=class{constructor(){this.buckets={}}addRoute(e,r,n){if(P(e,r),r[0]!=="/"&&r[0]!=="*")throw new Error("The first character of a path should be `/` or `*`.");r=r.replace(/\*([A-z0-9]+)?\//g,":!/").replace(/\*$/g,":!"),this.buckets[e]||(this.buckets[e]=new be.Node),this.buckets[e].addRoute(r,n)}findRoute(e,r){if(P(e,r),!this.buckets[e])return null;let n=this.buckets[e].search(r);return n.value===null?null:{value:n.value,params:n.params}}};l(M,"RoadRunner");b.RoadRunner=M});var B={};q(B,{default:()=>N});function S(t,e){return t?`\x1B[${t}m${e}\x1B[0m`:e}function V(t,e){for(let r of t.split(","))if(r.length===1)e=S(Se[r],e);else{let[n,i]=r.split("/"),s=G.indexOf(n),o=G.indexOf(i);s>-1&&(e=S(30+s,e)),o>-1&&(e=S(40+o,e))}return e}var Se,G,N,H=Ne(()=>{"use strict";Se={b:1,f:2,i:3,u:4,l:5,h:6,n:7,c:8,s:9},G=["black","red","green","yellow","blue","magenta","cyan","white","crimson"];l(S,"esc");l(V,"stylize");N=V;module.exports=V});var De={};q(De,{default:()=>$e});module.exports=W(De);var we=z(require("http"),1);var fe=z(U(),1);var He=(H(),W(B));function L(t,...e){let r=[t[0]],n=1;for(let i of e){let s=t[n++];if(s.startsWith("(")){let o=s.indexOf(")"),a=s.substring(1,o),d=He(a,i),E=s.substring(o+1);r.push(d,E)}}return r.join("")}l(L,"Concollor");H();function J(t){return(e,...r)=>{if(typeof e=="string")return N(t,e);let n=[e[0]],i=1;for(let s of r){let o=e[i++];n.push(String(s),o)}return N(t,n.join(""))}}l(J,"Tag");var c=J;module.exports=J;var K={titleTag:c("b,i,red/red"),messageTag:c("red/red"),defaultTitle:"Error"},Q={titleTag:c("b,i,yellow/yellow"),messageTag:c("yellow/yellow"),defaultTitle:"Warn"},X={titleTag:c("b,blue"),messageTag:c("blue"),defaultTitle:"Info"},Y={titleTag:c("b,green"),messageTag:c("green"),defaultTitle:"Success"},Z={titleTag:c("b,cyan"),messageTag:c("cyan"),defaultTitle:"Put"},_={titleTag:c("b,crimson"),messageTag:c("crimson"),defaultTitle:"Patch"},ee={titleTag:c("b,magenta"),messageTag:c("magenta"),defaultTitle:"Data"},re=/(https?:\/\/\S+)/gm;function f(t){let e=String(t);console.log(e.replace(re,r=>L`${r}(u,blue)`))}l(f,"Log");function w({titleTag:t,messageTag:e,defaultTitle:r}){return function(n,i){console.log(t(`${i??r}: `)+e(`${n}`))}}l(w,"_print");f.error=w(K);f.warn=w(Q);f.info=w(X);f.success=w(Y);f.put=w(Z);f.patch=w(_);f.data=w(ee);var p=f;module.exports=f;function te(t,e){let r=`The request method: ${t.method} is not supported by the server and cannot be handled`;p.error(r,`Error ${501}`),e.statusCode=501,e.statusMessage=r,e.end()}l(te,"NotImplementedHandler");var ne=te;module.exports=te;function oe(t,e,r){p.error("Unexpected Server Error",`Error ${500}`),p.error(r.message),e.statusCode=500,e.statusMessage="Internal Server Error",e.end()}l(oe,"ServerErrorHandler");var ie=oe;module.exports=oe;function se(t,e){let r=`The request ${t.method} ${t.url} is not allowed`;e.statusCode=405,e.statusMessage=r,e.end()}l(se,"MethodNotAllowedHandler");var le=se;module.exports=se;function ae(t,e){let r=`The request ${t.method} ${t.url} is not found`;e.statusCode=404,e.statusMessage=r,e.end()}l(ae,"NotFoundHandler");var pe=ae;module.exports=ae;function $(t){let e=t;for(;e.startsWith("/");)e=e.slice(1);for(;e.endsWith("/");)e=e.slice(0,-1);return"/"+e}l($,"normalizeSlash");function ce(t,e){let r=t??"",n=e??"";if(r.includes(":"))throw new Error("cant has semicolon");if(n.includes("*"))throw new Error("cant has semicolon");let i=[],s=n.split("/").reduce((a,d)=>{if(d.includes(":")){let E=d.slice(1);if(Le(E))i.push(d.slice(1));else throw new Error(`invalid var name: ${E}`);return a+"/"+d}return a+"/"+d},""),o=$(r);return{pathName:$(o+$(s)),prefix:o,props:i}}l(ce,"getPath");function Le(t){if(t.trim()!==t)return!1;try{new Function(t,"var "+t)}catch{return!1}return!0}l(Le,"isVarName");var he="GET";var de="POST",ue="PUT",ge="DELETE";var me="PATCH";var g=class{static addRoute(e,{method:r,prefix:n,path:i}){let{pathName:s}=ce(n,i);switch(r){case he:p.info(s,r);break;case de:p.warn(s,r);break;case ge:p.error(s,r);break;case me:p.patch(s,r);break;case ue:p.put(s,r);break;default:p.data(s,r)}g.router.addRoute(r,s,e)}getRequestHandler(e){if(e.method){let r=g.router.findRoute(e.method,e.url);return r?{handler:r.value,params:r.params}:{handler:g.routeHandlers.NotFound}}return{handler:g.routeHandlers.NotImplemented}}},h=g;l(h,"Router"),u(h,"ServerError",ie),u(h,"NotFound",pe),u(h,"MethodNotAllowed",le),u(h,"NotImplemented",ne),u(h,"router",new fe.RoadRunner),u(h,"routeHandlers",{GET:{},HEAD:{},POST:{},PUT:{},DELETE:{},CONNECTS:{},OPTIONS:{},TRACE:{},PATCH:{},ServerError:g.ServerError,NotFound:g.NotFound,MethodNotAllowed:g.MethodNotAllowed,NotImplemented:g.NotImplemented});var D=h;module.exports=h;function Oe(t,e){return p.error(t,`Middleware Error in ${e}`),new Error(t)}l(Oe,"MiddlewareError");var Te=Oe;var R=class{runMiddlewaresSync(e,r){let n=l(i=>{if(i instanceof Error)throw Te(i.message,"Middleware")},"next");for(let i of R.middlewares)i(e,r,n)}static use(e){R.middlewares.push(e)}},x=R;l(x,"Middleware"),u(x,"middlewares",[]),u(x,"asyncMiddlewares",[]);var ye=x;module.exports=x;var A=class{server;middleware;router;host;port;constructor(){this.requestListener=this.requestListener.bind(this),this.middleware=new ye,this.router=new D,this.server=we.default.createServer(this.requestListener),this.host=process.env.HOST||"localhost",this.port=Number(process.env.PORT)||3e3}requestListener(e,r){try{this.middleware.runMiddlewaresSync(e,r);let{handler:n,params:i}=this.router.getRequestHandler(e);n(e,r,i)}catch(n){D.routeHandlers.ServerError(e,r,n)}}run(){this.server.on("error",e=>{e.code==="EACCES"&&p.error(`No access to port: ${this.port}`,"EACCES")}),this.server.listen(this.port,()=>{p.success(`Server is running at http://${this.host}:${this.port}`)}),process.on("exit",()=>{this.server.close(()=>{p.warn(`Server is closed at http://${this.host}:${this.port}`)})}),process.on("exit",()=>{this.server.close(()=>{p.warn(`Server is closed at http://${this.host}:${this.port}`)})})}};l(A,"Server");var $e=A;module.exports=A;0&&(module.exports={});
//# sourceMappingURL=index.js.map
