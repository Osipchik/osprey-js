import e from"@/utils/Logger/concollor";var t,r={},n={};Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.STATIC=0]="STATIC",e[e.PARAM=1]="PARAM"}(t||(t={}));const i=":",s="/".charCodeAt(0);class o{constructor(e={}){this.indices=e.indices||"",this.children=e.children||[],this.childrenI=e.childrenI||{},this.path=e.path||"",this.handle=e.handle||null,this.wildChild=e.wildChild||!1,this.type=e.type||t.STATIC,this.param=e.param||"",this.pathLength=this.path.length,this.childrenLength=this.children.length}addRoute(e,t){const r=this.countParams(e);this.isEmpty()?this.insertChild(e,e,t,r):this.onChunk(this,e,e,t,r)}search(e){let t=this;const r={};e:for(;;){const n=e.length;if(n>t.pathLength&&e.slice(0,t.pathLength)===t.path){if(e=e.slice(t.pathLength),t.wildChild){t=t.children[0];let i=0;for(;i<n&&e.charCodeAt(i)!==s;)i++;const o=e.slice(0,i);if(!o||!t.param)return{value:null,params:r};if("!"!==t.param&&(r[t.param]=o),i<n){if(0===t.childrenLength)return{value:null,params:r};e=e.slice(i),t=t.children[0];continue e}return{value:t.handle,params:r}}const i=e.charCodeAt(0);for(let e=0;e<t.indices.length;e++)if(i===t.indices.charCodeAt(e)){t=t.children[e];continue e}}else if(e===t.path)return{value:t.handle,params:r};return{value:null,params:r}}}hasChildren(){return this.children.length>0}insertChild(e,r,n,s){let o=0,l=this;for(let n=0,h=r.length;s>0;n++){if(r[n]!==i)continue;let a=n+1;for(;a<h&&"/"!==r[a];){if(r[a]===i)throw new Error("only one wildcard per path segment is allowed, has: '"+r.slice(n)+"' in path '"+e+"'");a++}if(l.hasChildren())throw new Error("wildcard route '"+r.slice(n,a)+"' conflicts with existing children in path '"+e+"'");if(a-n<2)throw new Error("wildcards must be named with a non-empty name in path '"+e+"'");n>0&&(l.replacePath(r.slice(o,n)),o=n),l=l.replaceChildren({type:t.PARAM}),s--,a<h&&(l.replacePath(r.slice(o,a)),o=a,l=l.replaceChildren())}l.replacePath(r.slice(o)),l.setHandle(n)}setHandle(e){this.handle=e}replaceChildren(e={}){const r=new o(e);return e.type===t.PARAM&&(this.wildChild=!0),this.children=[r],this.childrenLength=1,r}replacePath(e){e[0]===i&&(this.param=e.slice(1)),this.path=e,this.pathLength=e.length}isEmpty(){return!(this.path.length>0||this.children.length>0)}processCharacter(e,r,n,s){const l=r[0];if(this.type===t.PARAM&&"/"===l&&1===this.children.length)return void this.onChunk(this.children[0],e,r,n,s);const h=this.childrenI[l.charCodeAt(0)];if(h)h.onChunk(h,e,r,n,s);else{if(l!==i){const i=new o({type:t.STATIC});return this.children.push(i),this.indices+=l,this.childrenI[l.charCodeAt(0)]=i,this.childrenLength=this.children.length,void i.insertChild(e,r,n,s)}this.insertChild(e,r,n,s)}}processWildcard(e,t,r,n){if(t.length>=this.path.length&&this.path===t.slice(0,this.path.length)&&(this.path.length>=t.length||"/"===t[this.path.length]))return void this.onChunk(this,e,t,r,n);const i=t.split("/")[0],s=e.slice(0,e.indexOf(i))+this.path;throw new Error(`'${i}' in new path '${e}' conflicts with existing wildcard '${this.path}' in existing prefix '${s}'`)}createNode(e,t,r,n,i){const s=r.slice(e);this.wildChild?this.children[0].processWildcard(t,s,n,i-1):this.processCharacter(t,s,n,i)}commonPrefixIndex(e){let t=0;const r=Math.min(e.length,this.path.length);for(;t<r&&this.path[t]===e[t];)t++;return t}split(e,t){if(e<this.path.length){const r=new o({path:this.path.slice(e),wildChild:this.wildChild,childrenI:this.childrenI,children:this.children,handle:this.handle,indices:this.indices});return this.children=[r],this.indices=this.path[e],this.childrenI={[this.indices.charCodeAt(0)]:r},this.childrenLength=1,this.wildChild=!1,this.path=t.slice(0,e),this.pathLength=this.path.length,this.handle=null,!0}return!1}onChunk(e,t,r,n,i){const s=e.commonPrefixIndex(r),o=e.split(s,r);if(s<r.length)e.createNode(s,t,r,n,i);else if(s===r.length){if(!o)throw new Error("Route already defined.");this.handle=n}}countParams(e){let t=0;for(let r=0;r<e.length;r++)e[r]===i&&t++;return t}}n.Node=o,Object.defineProperty(r,"__esModule",{value:!0});const l=n;function h(e,t){if(!t)throw new Error("Path is required.");if(!e)throw new Error("Bucket is required.");if("string"!=typeof e)throw new Error("Bucket should be a string.");if("string"!=typeof t)throw new Error("Path should be a string.")}var a=r.RoadRunner=class{constructor(){this.buckets={}}addRoute(e,t,r){if(h(e,t),"/"!==t[0]&&"*"!==t[0])throw new Error("The first character of a path should be `/` or `*`.");t=t.replace(/\*([A-z0-9]+)?\//g,":!/").replace(/\*$/g,":!"),this.buckets[e]||(this.buckets[e]=new l.Node),this.buckets[e].addRoute(t,r)}findRoute(e,t){if(h(e,t),!this.buckets[e])return null;const r=this.buckets[e].search(t);return null===r.value?null:{value:r.value,params:r.params}}};const d={b:1,f:2,i:3,u:4,l:5,h:6,n:7,c:8,s:9},c=["black","red","green","yellow","blue","magenta","cyan","white","crimson"];function u(e,t){return e?`[${e}m${t}[0m`:t}function p(e,t){for(const r of e.split(","))if(1===r.length)t=u(d[r],t);else{const[e,n]=r.split("/"),i=c.indexOf(e),s=c.indexOf(n);i>-1&&(t=u(30+i,t)),s>-1&&(t=u(40+s,t))}return t}function f(e){return(t,...r)=>{if("string"==typeof t)return p(e,t);const n=[t[0]];let i=1;for(const e of r){const r=t[i++];n.push(String(e),r)}return p(e,n.join(""))}}module.exports=p,module.exports=f;const g={titleTag:f("b,i,red/red"),messageTag:f("red/red"),defaultTitle:"Error"},m={titleTag:f("b,i,yellow/yellow"),messageTag:f("yellow/yellow"),defaultTitle:"Warn"},w={titleTag:f("b,blue"),messageTag:f("blue"),defaultTitle:"Info"},C={titleTag:f("b,green"),messageTag:f("green"),defaultTitle:"Success"},T={titleTag:f("b,cyan"),messageTag:f("cyan"),defaultTitle:"Put"},A={titleTag:f("b,crimson"),messageTag:f("crimson"),defaultTitle:"Patch"},E={titleTag:f("b,magenta"),messageTag:f("magenta"),defaultTitle:"Data"},N=/(https?:\/\/\S+)/gm;function b(t){const r=String(t);console.log(r.replace(N,(t=>e`${t}(u,blue)`)))}function v({titleTag:e,messageTag:t,defaultTitle:r}){return function(n,i){console.log(e(`${i??r}: `)+t(`${n}`))}}var I;function y(e,t){const r=`The request method: ${e.method} is not supported by the server and cannot be handled`;b.error(r,`Error ${I.NotImplemented}`),t.statusCode=I.NotImplemented,t.statusMessage=r,t.end()}function P(e,t,r){b.error("Unexpected Server Error",`Error ${I.InternalServerError}`),b.error(r.message),t.statusCode=I.InternalServerError,t.statusMessage="Internal Server Error",t.end()}function x(e,t){const r=`The request ${e.method} ${e.url} is not allowed`;t.statusCode=I.MethodNotAllowed,t.statusMessage=r,t.end()}function R(e,t){const r=`The request ${e.method} ${e.url} is not found`;t.statusCode=I.NotFound,t.statusMessage=r,t.end()}function S(e){let t=e;for(;t.startsWith("/");)t=t.slice(1);for(;t.endsWith("/");)t=t.slice(0,-1);return"/"+t}function M(e,t){const r=e??"",n=t??"";if(r.includes(":"))throw new Error("cant has semicolon");if(n.includes("*"))throw new Error("cant has semicolon");const i=[],s=n.split("/").reduce(((e,t)=>{if(t.includes(":")){const r=t.slice(1);if(!function(e){if(e.trim()!==e)return!1;try{new Function(e,"var "+e)}catch(e){return!1}return!0}(r))throw new Error(`invalid var name: ${r}`);return i.push(t.slice(1)),e+"/"+t}return e+"/"+t}),""),o=S(r);return{pathName:S(o+S(s)),prefix:o,props:i}}b.error=v(g),b.warn=v(m),b.info=v(w),b.success=v(C),b.put=v(T),b.patch=v(A),b.data=v(E),module.exports=b,function(e){e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.IMUsed=226]="IMUsed",e[e.BadRequest=400]="BadRequest",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented"}(I||(I={})),module.exports=y,module.exports=P,module.exports=x,module.exports=R;class k{static ServerError=P;static NotFound=R;static MethodNotAllowed=x;static NotImplemented=y;static router=new a;static routeHandlers={GET:{},HEAD:{},POST:{},PUT:{},DELETE:{},CONNECTS:{},OPTIONS:{},TRACE:{},PATCH:{},ServerError:k.ServerError,NotFound:k.NotFound,MethodNotAllowed:k.MethodNotAllowed,NotImplemented:k.NotImplemented};static addRoute(e,{method:t,prefix:r,path:n}){const{pathName:i}=M(r,n);switch(t){case"GET":b.info(i,t);break;case"POST":b.warn(i,t);break;case"DELETE":b.error(i,t);break;case"PATCH":b.patch(i,t);break;case"PUT":b.put(i,t);break;default:b.data(i,t)}k.router.addRoute(t,i,e)}getRequestHandler(e){if(e.method){const t=k.router.findRoute(e.method,e.url);return t?{handler:t.value,params:t.params}:{handler:k.routeHandlers.NotFound}}return{handler:k.routeHandlers.NotImplemented}}}module.exports=k;export{k as default};
//# sourceMappingURL=index.js.map
